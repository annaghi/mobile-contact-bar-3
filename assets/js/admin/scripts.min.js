/*!
 * Mobile Contact Bar 2.0.1 by Anna Bansaghi - http://mobilecontactbar.com
 * License GPL-3.0 - https://www.gnu.org/licenses/gpl-3.0.en.html
 */
!function($,document){"use strict";$.fn.addClassOdd=function(klass){return this.each(function(){$(this).removeClass(klass)}).filter(function(index){return index%2==1}).addClass(klass),this},$.fn.setId=function(id,rowType){var name,pattern="["+rowType+"][]",replacement="["+rowType+"]["+id+"]";return $(this).find("input, select, textarea").each(function(){name=$(this).attr("name"),$(this).attr("name",name.replace(pattern,replacement))}),this},$.fn.setActiveContact=function(checked){return checked?$(this).closest("tr").removeClass("mcb-odd").addClass("mcb-active"):$(this).closest("tr").removeClass("mcb-active"),this},$.fn.toggleAriaExpanded=function(){return this.attr("aria-expanded",function(index,attr){return"true"==attr?"false":"true"}),this},$.fn.initSettings=function(){var tbody=this,operators={"<":function(x,y){return Number(x)<Number(y[0])},"==":function(x,y){return x==y[0]},"!=":function(x,y){return x!=y[0]},"|==":function(x,y){return x==y[0]||x==y[1]}};return tbody.children(".mcb-child").each(function(){var parentClass="."+$(this).classList().find(function(klass){return klass.startsWith("mcb-parent-")}),parent=tbody.children(".mcb-parent"+parentClass),match=parent.classList().find(function(klass){return klass.startsWith("mcb-trigger-")}).match(/^mcb-trigger-([^a-zA-Z0-9]+)(.+)$/),operator=match[1],operands=match[2].split(","),value=""+parent.find("input").getValue();operators[operator](value,operands)?$(this).fadeIn(500):$(this).fadeOut(500)}),tbody.children(".mcb-parent").each(function(){var value,self=$(this),parentClass="."+self.classList().find(function(klass){return klass.startsWith("mcb-parent-")}),children=tbody.children(".mcb-child"+parentClass),match=self.classList().find(function(klass){return klass.startsWith("mcb-trigger-")}).match(/^mcb-trigger-([^a-zA-Z0-9]+)(.+)$/),operator=match[1],operands=match[2].split(",");self.find("input, option").on("change input",function(){value=""+$(this).getValue(),operators[operator](value,operands)?children.each(function(){$(this).fadeIn(500)}):children.each(function(){$(this).fadeOut(500)})})}),this},$.fn.sortableContacts=function(){var allParameters;return $(this).sortable({connectWith:"#mcb-table-contacts tbody",handle:".mcb-contact-icon",items:".mcb-contact",start:function(event,ui){ui.placeholder.height(ui.item.height()),(allParameters=$(this).children(".mcb-parameter")).addClass("hidden").detach(),$(this).children(".mcb-contact").each(function(){$(this).find(".mcb-row-toggle-parameters").children("i").attr("aria-expanded","false").removeClass("fa-caret-up").addClass("fa-caret-down")})},stop:function(){var contactId;$(this).children(".mcb-contact").each(function(){contactId=$(this).attr("data-contact-id"),allParameters.filter(function(i,parameter){return contactId==$(parameter).attr("data-contact-id")}).insertAfter($(this))}),allParameters=null,$(this).children(".mcb-contact").addClassOdd("mcb-odd")}}),this},$.fn.initContacts=function(){var contactId,parameter;return this.children(".mcb-contact").each(function(index){$(this).attr("data-contact-id",index)}),this.children(".mcb-parameter").each(function(index){parameter=$(this),contactId=parameter.prevAll("tr.mcb-contact").first().attr("data-contact-id"),parameter.attr("data-contact-id",contactId).attr("data-parameter-id",index).prevAll('.mcb-contact[data-contact-id="'+contactId+'"]').find(".mcb-row-toggle-parameters").removeClass("mcb-invisible")}),this.sortableContacts(),this},$.fn.getValue=function(){var value="";switch(this.attr("type")){case"number":value=this.val();break;case"checkbox":value=this.prop("checked");break;case"radio":value=this.filter(":checked").val();break;case"select":value=this.filter(":selected").val()}return value},$.fn.classList=function(){return this[0].className.split(/\s+/)},$.fn.maxId=function(rowType){var id=-1,attr="data-"+rowType+"-id";return 0===this.length||this.each(function(){id=Math.max(id,$(this).attr(attr))}),id};var option={init:function(){option.tbody=$("#mcb-table-contacts tbody"),postboxes.add_postbox_toggles(pagenow),$("#mcb-table-bar tbody, #mcb-table-icons tbody, #mcb-table-toggle tbody").initSettings(),option.tbody.initContacts(),option.onReady()},onReady:function(){$(".mcb-settings").on("input change",".mcb-slider-input",function(){$(this).next("span").html(this.value)}),$("#mcb-table-contacts thead").on({mouseenter:function(){$(this).removeClass("wp-ui-text-highlight").addClass("wp-ui-highlight")},mouseleave:function(){$(this).removeClass("wp-ui-highlight").addClass("wp-ui-text-highlight")}},".mcb-action"),option.tbody.on("change",".mcb-contact-checkbox input",function(event){event.preventDefault(),event.stopPropagation(),$(this).setActiveContact(this.checked)}),option.tbody.on("click",".mcb-row-toggle-parameters",function(event){event.preventDefault(),event.stopPropagation();var button=$(this).children("i"),contact=button.closest("tr"),contactId=contact.attr("data-contact-id"),parameters=option.tbody.find('.mcb-parameter[data-contact-id="'+contactId+'"]');parameters.toggleClass("hidden"),button.toggleAriaExpanded().toggleClass("fa-caret-up fa-caret-down"),"true"==button.attr("aria-expanded")?parameters.first().find(".mcb-parameter-value input, .mcb-parameter-value textarea").focus():contact.find(".mcb-contact-uri input").focus()}),option.tbody.on("click",".mcb-row-delete-contact",function(event){event.preventDefault(),event.stopPropagation();var contactId=$(this).closest("tr").attr("data-contact-id");option.tbody.children('[data-contact-id="'+contactId+'"]').remove(),option.tbody.children(".mcb-contact").addClassOdd("mcb-odd")}),option.tbody.on("click",".mcb-row-delete-parameter",function(event){event.preventDefault(),event.stopPropagation();var contactId=$(this).closest("tr").attr("data-contact-id");$(this).closest("tr").remove(),0===option.tbody.find('.mcb-parameter[data-contact-id="'+contactId+'"]').length&&option.tbody.find('.mcb-contact[data-contact-id="'+contactId+'"]').find(".mcb-row-toggle-parameters").addClass("mcb-invisible").children("i").attr("aria-expanded","false").removeClass("fa-caret-up").addClass("fa-caret-down")}),option.tbody.on("click",".mcb-row-add-parameter",function(event){event.preventDefault(),event.stopPropagation();var contact=$(this).closest(".mcb-contact"),parameter=$($.parseHTML($("#mcb-tmpl-parameter").html().replace(/\s{2,}/g,""))),contactId=contact.attr("data-contact-id"),parameters=option.tbody.find('.mcb-parameter[data-contact-id="'+contactId+'"]'),parameterId=parameters.maxId("parameter")+1;contact.find(".mcb-row-toggle-parameters").removeClass("mcb-invisible").children("i").attr("aria-expanded","true").addClass("fa-caret-up").removeClass("fa-caret-down"),0===parameters.length?contact.after(parameter):(parameters.removeClass("hidden"),parameters.last().after(parameter)),parameter.attr("data-contact-id",contactId).attr("data-parameter-id",parameterId).setId(contactId,"contacts").setId(parameterId,"parameters").find(".mcb-parameter-key").focus()}),option.tbody.on("click",".mcb-row-pick-icon",function(event){event.preventDefault(),event.stopPropagation(),setTimeout(function(){$("#mcb-icon-picker-container div input").focus()},100);var list,button=$(this),offset=button.offset(),contact=button.closest("tr").addClass("mcb-overlay");$($.parseHTML($("#mcb-tmpl-icon-picker").html().replace(/\s{2,}/g,""))).css({top:offset.top-12,left:offset.left-160}).appendTo("body").show(),list=$("#mcb-icon-picker-container ul"),$("body").off("click","#mcb-icon-picker-container ul li a").on("click","#mcb-icon-picker-container ul li a",function(event){event.preventDefault(),event.stopPropagation();var icon=$(this).children().attr("class");contact.find(".mcb-contact-icon i").removeClass().addClass(icon+" fa-lg").end().find('input[name$="[icon]"]').val(icon).end().removeClass("mcb-overlay"),$("#mcb-icon-picker-container").remove(),contact.removeClass("mcb-warning")}),$("body").off("click","#mcb-icon-picker-container div a").on("click","#mcb-icon-picker-container div a",function(event){event.preventDefault(),event.stopPropagation(),"back"===$(this).attr("data-direction")?list.find("li:gt("+(list.children().length-26)+")").prependTo(list):list.find("li:lt(30)").appendTo(list)}),$("body").off("input","#mcb-icon-picker-container div input").on("input","#mcb-icon-picker-container div input",function(event){event.preventDefault(),event.stopPropagation();var search=$(this).val();""===search?list.find("li:lt(30)").show():(list.children().not('[data-icon*="'+search+'"]').hide(),list.children('[data-icon*="'+search+'"]').show())}),$(document).off("mouseup").on("mouseup",function(event){event.preventDefault(),event.stopPropagation(),$("#mcb-icon-picker-container").is(event.target)||0!==$("#mcb-icon-picker-container").has(event.target).length||($("#mcb-icon-picker-container").remove(),contact.removeClass("mcb-overlay"))})}),$("#mcb-integration-icons .mcb-action, #mcb-integration-buttons .mcb-action").click(function(event){event.preventDefault(),event.stopPropagation();var contactType=$(this).attr("data-contact-type"),contactId=option.tbody.children(".mcb-contact").maxId("contact")+1,thead=$("#mcb-table-contacts thead");$.ajax({url:ajaxurl,method:"POST",data:{action:"ajax_add_contact",nonce:mobile_contact_bar.nonce,contact_type:contactType},beforeSend:function(){var position=thead.position(),overlay=$("<tr>",{class:"mcb-overlay"});overlay.css({position:"absolute",top:position.top,left:position.left,height:thead.height(),width:thead.width()}),thead.prepend(overlay)}}).done(function(response){if(!response)return!1;var data=JSON.parse(response);if(!data.hasOwnProperty("contact"))return!1;var contact=$($.parseHTML(data.contact)[0]);if(contact.attr("data-contact-id",contactId).setId(contactId,"contacts"),option.tbody.prepend(contact),option.tbody.sortableContacts().children(".mcb-contact").addClassOdd("mcb-odd"),data.hasOwnProperty("parameters")){var parameter;contact.find(".mcb-row-add-parameter").addClass("mcb-invisible").end().find(".mcb-row-toggle-parameters").removeClass("mcb-invisible").children("i").attr("aria-expanded","false").removeClass("fa-caret-up").addClass("fa-caret-down");for(var i=data.parameters.length-1;-1<i;i--)(parameter=$(data.parameters[i])).attr("data-contact-id",contactId).attr("data-parameter-id",i).setId(contactId,"contacts").setId(i,"parameters"),contact.after(parameter)}}).always(function(){thead.find(".mcb-overlay").remove()})})}};$(document).ready(option.init)}(jQuery,document);