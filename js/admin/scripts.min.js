/*!
 * Mobile Contact Bar 3.0.0 by Anna Bansaghi - http://mobilecontactbar.com
 * License GPL-2.0 - https://www.gnu.org/licenses/gpl-2.0.en.html
 */
!function($,window,document){"use strict";$.fn.toggleAriaExpanded=function(){return this.attr("aria-expanded",function(index,attr){return"true"==attr?"false":"true"}),this},$.fn.initSettings=function(){var tbody=this,operators={"<":function(x,y){return Number(x)<Number(y)},"==":function(x,y){return x==y},"!=":function(x,y){return x!=y}};return tbody.children(".mcb-child").each(function(){var operand="."+$(this).classList().find(function(klass){return klass.startsWith("mcb-parent-")}),parent=tbody.children(".mcb-parent"+operand),value=parent.classList().find(function(klass){return klass.startsWith("mcb-trigger-")}).match(/^mcb-trigger-([<=!]+)(.*)$/),operator=value[1],operand=value[2]||"",value="";"true"===operand||!0===operand?(value=parent.find("input").toArray().reduce((acc,inputEl)=>acc||$(inputEl).getValue(),!1),operand=!0):value=""+parent.find("input").getValue(),operators[operator](value,operand)?$(this).fadeIn(500):$(this).fadeOut(500)}),tbody.children(".mcb-parent").each(function(){var self=$(this),match="."+self.classList().find(function(klass){return klass.startsWith("mcb-parent-")}),children=tbody.children(".mcb-child"+match),match=self.classList().find(function(klass){return klass.startsWith("mcb-trigger-")}).match(/^mcb-trigger-([<=!]+)(.*)$/),operator=match[1],operand=match[2]||"",value="";self.find("input, option").on("change input",function(){"true"===operand||!0===operand?(value=self.find("input").toArray().reduce((acc,inputEl)=>acc||$(inputEl).getValue(),$(this).getValue()),operand=!0):value=""+$(this).getValue(),operators[operator](value,operand)?children.each(function(){$(this).fadeIn(500)}):children.each(function(){$(this).fadeOut(500)})})}),this},$.fn.initSortableContacts=function(){return $(this).sortable({connectWith:"#mcb-contacts",handle:".mcb-sortable-draggable",items:".mcb-contact",start:function(event,ui){document.activeElement.blur(),$(this).find(".mcb-contact").removeClass("mcb-opened").end().find(".mcb-action-toggle-details i").attr("aria-expanded","false"),ui.placeholder.height(ui.item.children(".mcb-summary").outerHeight()),ui.helper.height(ui.item.children(".mcb-summary").outerHeight()),ui.placeholder.css("visibility","visible"),$(this).sortable("refresh","refreshPositions")}}),this},$.fn.getValue=function(){var value="";switch(this.attr("type")){case"text":case"number":value=this.val();break;case"checkbox":value=this.prop("checked");break;case"radio":value=this.filter(":checked").val();break;case"select":value=this.filter(":selected").val()}return value},$.fn.classList=function(){return this[0].className.split(/\s+/)},$.fn.maxId=function(rowType){var id=-1,attr="data-"+rowType+"-id";return 0===this.length||this.each(function(){id=Math.max(id,$(this).attr(attr))}),id};var option={init:function(){postboxes.add_postbox_toggles(pagenow),$("#mcb-table-bar tbody, #mcb-table-icons_labels tbody, #mcb-table-toggle tbody").initSettings(),option.contactList=$("#mcb-contacts"),option.contactList.initSortableContacts(),option.onReady()},onReady:function(){$(".mcb-settings").on("input change",".mcb-slider-input",function(){$(this).next("span").html(this.value+" "+$(this).data("postfix"))}),option.contactList.on("change",".mcb-summary-checkbox input",function(event){event.preventDefault(),event.stopPropagation(),this.checked?$(this).closest(".mcb-summary").addClass("mcb-checked"):$(this).closest(".mcb-summary").removeClass("mcb-checked")}),$("#mcb-add-contact").click(function(event){event.preventDefault(),event.stopPropagation();var contactId=option.contactList.children(".mcb-contact").maxId("contact")+1;$.ajax({url:ajaxurl,method:"POST",data:{action:"add-contact",nonce:mobile_contact_bar.nonce,contact_id:contactId}}).done(function(contact){if(!contact)return!1;var data=JSON.parse(contact);if(!data.hasOwnProperty("summary")||!data.hasOwnProperty("details"))return!1;contact=document.createElement("div");$(contact).addClass("mcb-contact"),$(contact).attr("data-contact-id",contactId),$(contact).append($(data.summary)).append($(data.details)),$(contact).find(".color-picker").wpColorPicker(),option.contactList.append(contact)})}),option.contactList.on("click",".mcb-action-delete-contact",function(event){event.preventDefault(),event.stopPropagation(),$(this).closest(".mcb-contact").remove()}),option.contactList.on("click",".mcb-action-toggle-details",function(event){event.preventDefault(),event.stopPropagation(),$(this).closest(".mcb-contact").toggleClass("mcb-opened"),$(this).children("i").toggleAriaExpanded()}),option.contactList.on("click",".mcb-action-order-higher",function(contact){contact.preventDefault(),contact.stopPropagation();var focused=document.activeElement,prev=$(this).closest(".mcb-contact").prev(),contact=$(this).closest(".mcb-contact").detach();prev.before(contact),focused.focus()}),option.contactList.on("click",".mcb-action-order-lower",function(contact){contact.preventDefault(),contact.stopPropagation();var focused=document.activeElement,next=$(this).closest(".mcb-contact").next(),contact=$(this).closest(".mcb-contact").detach();next.after(contact),focused.focus()}),option.contactList.on("change",".mcb-details-type select",function(contactId){contactId.preventDefault(),contactId.stopPropagation();var contact=$(this).closest(".mcb-contact"),contactId=contact.attr("data-contact-id");$.ajax({url:ajaxurl,method:"POST",data:{action:"change-contact_type",nonce:mobile_contact_bar.nonce,contact_id:contactId,contact_type:$(this).val()}}).done(function(data){if(!data)return!1;data=JSON.parse(data);if(!data.hasOwnProperty("contact")||!data.hasOwnProperty("parameters"))return!1;contact.find(".mcb-details-uri").replaceWith($(data.contact)),contact.find(".mcb-builtin-parameters, .mcb-custom-parameters, .mcb-builtin-parameter, .mcb-custom-parameter").detach(),contact.find(".mcb-details-uri").after($(data.parameters))})}),option.contactList.on("click",".mcb-action-pick-icon",function(event){event.preventDefault(),event.stopPropagation(),setTimeout(function(){$("#mcb-icon-picker-container div input").focus()},100);var iconList,offset=$(this).offset(),contact=$(this).closest(".mcb-contact");$($.parseHTML($("#mcb-tmpl-icon-picker").html().replace(/\s{2,}/g,""))).css({top:offset.top-15,left:offset.left}).appendTo("body").show(),iconList=$('#mcb-icon-picker-container ul[data-brand="fa"]'),$("body").off("click","#mcb-icon-picker-container button").on("click","#mcb-icon-picker-container button",function(event){event.preventDefault(),event.stopPropagation(),"ti"===$(this).attr("data-brand")?($("#mcb-icon-picker-container").find("button").removeClass("mcb-icon-brand-active"),$(this).addClass("mcb-icon-brand-active"),$('#mcb-icon-picker-container ul[data-brand="fa"]').addClass("mcb-hidden"),(iconList=$('#mcb-icon-picker-container ul[data-brand="ti"]')).removeClass("mcb-hidden")):($("#mcb-icon-picker-container").find("button").removeClass("mcb-icon-brand-active"),$(this).addClass("mcb-icon-brand-active"),$('#mcb-icon-picker-container ul[data-brand="ti"]').addClass("mcb-hidden"),(iconList=$('#mcb-icon-picker-container ul[data-brand="fa"]')).removeClass("mcb-hidden"))}),$("body").off("click","#mcb-icon-picker-container ul li a").on("click","#mcb-icon-picker-container ul li a",function(icon){icon.preventDefault(),icon.stopPropagation();icon=$(this).children().attr("class");contact.find('input[name$="[icon]"]').val(icon).end().find(".mcb-summary-icon i").removeClass().addClass(icon).empty().end().find(".mcb-details-icon i").removeClass().addClass(icon).empty(),$("#mcb-icon-picker-container").remove()}),$("body").off("click","#mcb-icon-picker-container div a").on("click","#mcb-icon-picker-container div a",function(event){event.preventDefault(),event.stopPropagation(),"back"===$(this).attr("data-direction")?iconList.find("li:gt("+(iconList.children().length-31)+")").prependTo(iconList):iconList.find("li:lt(30)").appendTo(iconList)}),$("body").off("input","#mcb-icon-picker-container div input").on("input","#mcb-icon-picker-container div input",function(searchTerm){searchTerm.preventDefault(),searchTerm.stopPropagation();searchTerm=$(this).val();""===searchTerm?iconList.find("li:lt(30)").show():(iconList.children().not('[data-icon*="'+searchTerm+'"]').hide(),iconList.children('[data-icon*="'+searchTerm+'"]').show())}),$(document).off("mouseup").on("mouseup",function(event){event.preventDefault(),event.stopPropagation(),$("#mcb-icon-picker-container").is(event.target)||0!==$("#mcb-icon-picker-container").has(event.target).length||$("#mcb-icon-picker-container").remove()}),$(window).resize(function(){$("#mcb-icon-picker-container").is(event.target)||0!==$("#mcb-icon-picker-container").has(event.target).length||$("#mcb-icon-picker-container").remove()})}),option.contactList.on("click",".mcb-action-clear-icon",function(event){event.preventDefault(),event.stopPropagation(),$(this).closest(".mcb-contact").find('input[name$="[icon]"]').val("").end().find(".mcb-summary-icon i").removeClass().addClass("mcb-blank-icon").text("---").end().find(".mcb-details-icon i").removeClass().addClass("mcb-blank-icon").text("---")}),option.contactList.on("input",".mcb-details-label input",function(event){event.preventDefault(),event.stopPropagation(),$(this).closest(".mcb-contact").find(".mcb-summary-label").text($(this).val())}),option.contactList.on("input",".mcb-details-uri input",function(event){event.preventDefault(),event.stopPropagation(),$(this).closest(".mcb-contact").find(".mcb-summary-uri").text($(this).val())}),option.contactList.on("click",".mcb-add-parameter",function(contactId){contactId.preventDefault(),contactId.stopPropagation();var contact=$(this).closest(".mcb-contact"),parameterId=contact.find(".mcb-custom-parameter"),contactId=contact.attr("data-contact-id"),parameterId=parameterId.maxId("parameter")+1;$.ajax({url:ajaxurl,method:"POST",data:{action:"add-parameter",nonce:mobile_contact_bar.nonce,contact_id:contactId,parameter_id:parameterId}}).done(function(parameter){if(!parameter)return!1;parameter=JSON.parse(parameter);if(parameter.length<=0)return!1;contact.find(".mcb-custom-parameters").after($(parameter))})}),option.contactList.on("click",".mcb-action-delete-parameter",function(event){event.preventDefault(),event.stopPropagation(),$(this).closest(".mcb-custom-parameter").remove()})}};$(document).ready(option.init)}(jQuery,window,document);